<h1 id="section"></h1>
<p>来翻新一下博客网站吧！</p>
<p>大概在2022年的五六月份，甚至可能更早的时候便逐渐萌生了这样的想法。但由于各种各样的原因，最终还是拖到了现在才开始着手这件事。</p>
<p>开工时，一开始想的是本着一切从简的中心思想，三两天搞定网站的翻新。但实际折腾中也发现，这事还真不太简单。于是这么（至少对于我来说）伤筋动骨的事情，自然也是要给它记录下来的。</p>
<br>
<h2 id="php">PHP 从入门到放弃</h2>
<p>为什么要翻新网站呢？萌生出这个想法，主要是原网站是采用WordPress搭建的，维护起来比较耗费精力，并且个人对PHP的开发不熟悉，如果想对网站有所改动也比较费事。顺便也  想试着把博客放到提供纯静态网页托管服务的平台，如Github Pages或是Netlify，这样维护起来会省去很多事，也几乎不用担心安全性问题什么的。（顺带也比独立开着一个服务器和CDN要省钱）</p>
<p>当然这样一来，WordPress就不适合了，PHP当然没法当成静态网页去托管，得把博客网站变成一个没有服务器的纯客户端（前端）网站。</p>
<p>顺着这个思路，首先最容易想到的做法就是，把WordPress网站跑在局域网等私有网络环境，然后把WordPress的每一页抓取成静态的html文件，然后上传托管，然后完事。</p>
<p>但这个想法最终还是因为个人对PHP的开发不熟悉而没太成功，那果然还是“随大流”一点，采用Markdown编写文字，然后通过工具生成html网页的形式来做新的博客站吧。</p>
<p>当然，要这么搞一遍，首先面临的一个头疼的大问题，就是网站旧数据的迁移。</p>
<br>
<h2 id="wordpressmarkdown">从WordPress博文到Markdown</h2>
<p>首先要说的是，虽然网络上随处可以搜到WordPress备份导出到Markdown的方案方法。但实际用起来，真的不怎么理想，各有各的问题。甚至其实，你把文章从WordPress网站备份然后还原到另一个WordPress网站，都有可能出问题。</p>
<p>普通的文字排版，确实没啥问题，然后遇到图片就歇菜了。我原网站的图片是放在云服务商的对象存储中的，然后用各种网络上的WordPress转Markdown方案，也就是得到了一堆<code>![](xxxx.png)</code>指向了对象存储的URL. 这个不太符合我的需求，于是又写了个工具，把图片什么的先都从对象存储中下载到本地。但Markdown里的图片url还指向对象存储呢，这个问题暂且不表，后面再说。</p>
<p>然后是代码和复杂图表。代码之类的东西，在原版的WordPress里显示也不是很美好的，为了更好的体验得用插件。这就导致导出的时候成了麻烦事，导出的markdown格式全乱了。但这一部分也没想好怎么自动化的处理，于是，最终变成了手动的力气活，挨个文件手动的去编辑了一遍。</p>
<p>（编辑过程中发现不少几年前写的东西实在谁的不行，看不下去，又删掉了一部分实在忍不了的。大部分还是冲着“这是童年的美好回忆”这种想法给保留了下来）</p>
<br>
<h2 id="section-1">选一个静态博客生成工具吧</h2>
<p>说到用Markdown写博客，然后用静态工具生成网页，那么通常人们就会想到Jekyll、Hexo、Hugo这些。这些我大概都试用过，有各自的特色和优缺点，网络上也有很多对比文章。</p>
<p>那么我现在也面临这样的问题了，选哪个呢？</p>
<p>得试试，可是在试用这些工具的时候，我也发现了一个问题，就是虽然同样是Markdown，但在这些不同的工具里，Markdown文件也不太通用。</p>
<p>首先是不同工具中Markdown的语法不太一致，它们各自有一些不太符合Markdown规范的小“语法糖”。然后就是它们放在Markdown文件顶部的元数据，也就是一些配置文件，也不太一致。</p>
<p>更烦的是，对文中插图的时候，资源路径的引用也不太一致。比如Hugo中默认我可以使用Markdown文件同级的相对路径来插入图片，这也符合我常用的Markdown编辑器（包括VSCode）的喜欢。而在Hexo中却默认并不能这么干，我在网络中搜到了一些折腾方法，但确实挺折腾的。</p>
<p>然后就不是单纯的选工具的问题了，上述的这些差异表明，如果我选定了一个工具，那之后可能就得和这个工具绑死了，如果要再换一次，又得像WordPress这次这种伤筋动骨。这让本来就有选择困难的人更加难以选择了。</p>
<br>
<h2 id="markdown">搞一个纯粹的Markdown仓库呗</h2>
<p>讲真，没有什么事是加一层封装不能解决的，于是接下来我便想出了这么一个方法。</p>
<ul>
<li>首先，我们建立一个纯粹的Markdown仓库，这个仓库里只有存储的博客文章，不考虑任何其他的东西。</li>
<li>因为纯粹的原版Markdown可能确实不够用来做整个网站，于是这个Markdown仓库得有一些属于自己的“方言”，或者说“语法糖”。比如点击链接之后是在新标签页打开还是直接原地跳转，比如插入Twitter卡片等等。</li>
<li>这个Markdown仓库也会有一些属于自己的文章结构，文章元数据（比如标题、作者、日期、标签、分类等等），以及图片等资产的存放结构的规范。</li>
<li>然后，我们通过编写一些工具，来把这个属于我们自己独特定义的Markdown仓库，转换成我们想要的格式，比如Jekyll、Hexo、Hugo等等。</li>
</ul>
<p>这样一来，在写点东西这件事上，我们可以搞的更加纯粹一些。于是就有了这样一个东西：</p>
<p><img src="blog/posts/101/assets/1.png" class="img-fluid" alt="" /></p>
<p><img src="blog/posts/101/assets/2.png" class="img-fluid" alt="" /></p>
<p>可以看出，文件目录的结构也比较简单，用年份来分文件夹，然后是文章标题。然后每个文章有独立的存放图片等资产的文件夹，Markdown中统一使用相对路径来引用这些资产。</p>
<p>而像Hexo、Hugo那样写在每个Markdown文件头部的YAML元数据，因为强迫症觉得别扭，也就没放在Markdown文件里，而是放在了一个单独的JSON文件里。</p>
<p><img src="blog/posts/101/assets/3.png" class="img-fluid" alt="" /></p>
<p>（json文件也分了两个,其中<code>*.data.json</code>放一些和文章相关的，给人类编辑用的元数据，比如标题、描述、封面、时间等等，<code>*.meta.json</code>放一些和文章无关的，给机器用的元数据，比如文件的hash、唯一ID等等，以辅助机器生成需要的内容。）</p>
<br>
<h2 id="section-2">干脆自己把网站部分也做了吧</h2>
<p>但是，做到上述的步骤之后，就发现，如果我们写的程序能够处理Markdown仓库的话，那就意味着，我们的程序要能去解析Markdown. 以及前文说所的，从对象存储中迁移图片的问题，也是需要解析并修改Markdown的。</p>
<p>那么……反正都得自己解析Markdown了，那干脆就顺便把生成HTML的部分也做了吧。</p>
<p>那就干脆自己把网站部分也做了吧。</p>
<p>关于网站怎么做，大概是两种思路，其一是解析Markdown的时候，顺便输出完整的每一页带样式的HTML文件，其二是解析Markdown的工具进行一些简单的预处理，然后交给一个跑在浏览器上的Web App进行最终的代码拼接。</p>
<p>两种方案各有优劣，其实我也没啥特别倾向于某种方案的想法。但终究还是得选一种开始做起来啊，于是最终决定的方案，就是后者，一个跑在浏览器上的Web App.</p>
<br>
<h2 id="csharp">CSharp，但是没有服务器，跑在了浏览器</h2>
<p>我倒不算是专业的Web开发人员，也没正经学过。但大概也能知道，通常做一个跑在浏览器上的Web App，也就是React、Vue、Anuglar御三家里挑一个，怎么说也跳不出JavaScript和TypeScript的圈子。</p>
<p>但反正是自己的博客，没有甲方也没有KPI，可以稍微随性一点，可以选择小众的技术方向，而不用担心有什么缺陷或者开发上有什么不爽，只要自己喜欢就好了。</p>
<p>抱着这样的心态，网站最终使用了C#作为主要开发语言。</p>
<h3 id="section-3">大前端，真的大，大出声</h3>
<p>正如前文所说，最终的博客网站是一个跑在浏览器上的App，或者用更通俗的话说叫SPA（Single Page Application）。</p>
<p>于是我们的博客网站也就有了一些SPA不可避免的缺点，比如说，它太大了。</p>
<p>而对于一个使用C#开发的SPA，这一缺点就更明显了，体积大到了有点令人发指的地步。</p>
<p>因为众所周知，通常的普通的浏览器是没法运行C#代码的，所以我们的C#代码，就得经过一些特殊的操作，才能在浏览器上运行。实际在当前如果打开浏览器的开发者工具，就能看到，很多的加载时间都花在了加载一堆dll文件上。最终首屏加载的体积高达两三兆，首屏加载时间也就近十秒。</p>
<p>而如果是某些特殊地区的网络环境，这个加载时间有时候更是离谱到将近一分钟。</p>
<p><img src="blog/posts/101/assets/4.png" class="img-fluid" alt="" /></p>
<p>当然真要说起来，是有一些优化思路的。但可能得等等，现阶段是能跑就行，等各种功能都做完了，再来优化吧。目前预计等各种优化搞起来一波之后，首屏加载时间到两三秒问题不大（当然，不考虑某些特殊地区的网络环境）</p>
<br>
<h3 id="section-4"></h3>
